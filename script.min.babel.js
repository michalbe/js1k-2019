var CIRCLE=2*Math.PI;const wall_text="JS1K";let color=[0,255,0],i=-1,RayMap_walls=["e","1","3","w","t","d","m","n","7","n","0","7","9","t","s","f","7","q","y","2","0","n","a","z","7","g","c","e","p","y","a","z","c","0","z","1","t","c","v","v","a","u","t","q","j","r","r","r","a","x","1","p","p","c","9","r","b","c","y","t","d","c","c","x","d","3","3","0","9","8","l","t","c","0","2","y","t","h","h","x","c","e","v","f","b","0","1","r"].reduce((a,b,c)=>(a[i],0==c%8&&(i++,a[i]=""),a[i]+=b,a),[]).map(a=>parseInt(a,36).toString(2)).join("").split(""),RayMap_light=2,RayMap_width=20,RayMap_height=22,RayMap_outdoors=!1;function RayMap_Get(a,b){return a|=0,b|=0,0>a||a>=RayMap_width||0>b||b>=RayMap_height?-1:RayMap_walls[b*RayMap_width+a]}function RayMap_Raycast(a,b,c,d=!1){var e,f,g,h=[],i=Math.sin(b),j=Math.cos(b);g={x:a.x,y:a.y,cell:0,distance:0};do{if(h.push(g),!d&&0<g.cell)break;e=RayMap___step(i,j,g.x,g.y),f=RayMap___step(j,i,g.y,g.x,!0),g=e.length2<f.length2?RayMap___inspect(e,1,0,g.distance,e.y,j,i):RayMap___inspect(f,0,1,g.distance,f.x,j,i)}while(g.distance<=c);return h}function RayMap___step(a,b,c,d,e){if(0===b)return{length2:1/0};var f=0<b?~~(c+1)-c:Math.ceil(c-1)-c,g=f*a/b;return{x:e?d+g:c+f,y:e?c+f:d+g,length2:f*f+g*g}}function RayMap___inspect(a,b,c,d,e,f,g){var h=Math.sqrt,i=0>f?b:0,j=0>g?c:0,k=(0|a.y-j)*RayMap_width+(0|a.x-i);return a.cell=0>k||k>=RayMap_walls.length?-1:RayMap_walls[k],a.distance=d+h(a.length2),a.shading=0,a.offset=e-(0|e),a}let RayCamera_fov=.4*Math.PI,RayCamera_range=14,RayCamera_lightRange=5,RayCamera_p={x:0,y:0},RayCamera_dir=.5*Math.PI;function RayCamera_Rotate(a){RayCamera_dir=(RayCamera_dir+a+CIRCLE)%CIRCLE}let RaycastRenderer_domElement=document.getElementById("canvas"),RaycastRenderer_width=640,RaycastRenderer_height=360,RaycastRenderer_resolution=28,RaycastRenderer_ctx=RaycastRenderer_domElement.getContext("2d"),RaycastRenderer_spacing=RaycastRenderer_width/RaycastRenderer_resolution;RaycastRenderer_domElement.width=RaycastRenderer_width,RaycastRenderer_domElement.height=RaycastRenderer_height;function RaycastRenderer___project(a,b,c){var d=c*Math.cos(b),e=RaycastRenderer_height*a/d;return{top:RaycastRenderer_height/2*(1+1/d)-e,height:e}}function RaycastRenderer___drawColumn(a,b,c){for(var d=Math.ceil,e=~~(a*RaycastRenderer_spacing),f=d(RaycastRenderer_spacing),g=-1;++g<b.length&&0>=b[g].cell;);if(g<b.length){RaycastRenderer_ctx.save();var h=b[g];const d=wall_text[a%wall_text.length];var i=RaycastRenderer___project(1,c,h.distance);RaycastRenderer_ctx.globalAlpha=1;const j=1-Math.max((h.distance+h.shading)/RayCamera_lightRange,0);RaycastRenderer_ctx.fillStyle="rgba("+color[0]+", "+color[1]+", "+color[2]+", "+j+")",RaycastRenderer_ctx.font=i.height+"px Arial";const k=RaycastRenderer_ctx.measureText(d),l=k.width,m=f/l;RaycastRenderer_ctx.scale(m,1),RaycastRenderer_ctx.fillText(d,e/m,i.top+i.height),RaycastRenderer_ctx.restore()}}function RaycastRenderer___drawColumns(){RaycastRenderer_ctx.save();for(var a=0;a<RaycastRenderer_resolution;a++){var b=RayCamera_fov*(a/RaycastRenderer_resolution-.5),c=RayMap_Raycast(RayCamera_p,RayCamera_dir+b,RayCamera_range);RaycastRenderer___drawColumn(a,c,b)}RaycastRenderer_ctx.restore()}function RaycastRenderer_Render(){RaycastRenderer___drawColumns()}function RaycastRenderer_Raycast(a,b,c){return RayMap_Raycast(a,b,c)}let Controls_codes={37:"l",39:"r",38:"f",40:"b"},Controls_states={l:!1,r:!1,f:!1,b:!1};document.addEventListener("keydown",Controls_onKey.bind(this,!0),!1),document.addEventListener("keyup",Controls_onKey.bind(this,!1),!1);function Controls_onKey(a,b){var c=Controls_codes[b.keyCode];c&&(Controls_states[c]=a)}var p={x:2.8,y:3.7},dir=.3*Math.PI,rot=a=>{dir=(dir+a+CIRCLE)%CIRCLE,RayCamera_dir=dir},walk=a=>{var b=Math.cos(dir)*a,c=Math.sin(dir)*a;0>=RayMap_Get(p.x+b,p.y)&&(p.x+=b),0>=RayMap_Get(p.x,p.y+c)&&(p.y+=c),RayCamera_p.x=p.x,RayCamera_p.y=p.y},update=a=>{var b=Math.PI;Controls_states.l&&rot(-b*a),Controls_states.r&&rot(b*a),Controls_states.f&&walk(3*a),Controls_states.b&&walk(-3*a)};RayCamera_dir=dir,RayCamera_p.x=p.x,RayCamera_p.y=p.y;var lastTime=0,mapPos={x:-44,y:-44};function UpdateRender(a){var b=(a-lastTime)/1e3;lastTime=a,.2>b&&(update(b),canvas.width=canvas.width,RaycastRenderer_Render()),requestAnimationFrame(UpdateRender)}UpdateRender();